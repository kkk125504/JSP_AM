### 디스패쳐 서블릿 도입, articleService(List), articleDao(List) 도입  

**1\) 디스패쳐 서블릿**

```java
    @WebServlet("/s/*")
    public class DispatcherServlet extends HttpServlet {
        protected void doGet(HttpServletRequest request, HttpServletResponse response)
                throws ServletException, IOException {
            response.setContentType("text/html; charset=UTF-8");

            String requestUri = request.getRequestURI();
            String[] requestUriBits = requestUri.split("/");
            if(requestUriBits.length < 5) {
                response.getWriter().append("올바른 요청이 아닙니다.");
                return;
            }
            
            String controllerName = requestUriBits[3];
			String actionMethodName = requestUriBits[4];
			if(controllerName.equals("article")) {
				ArticleController articleController = new ArticleController(request,response,conn);
				if(actionMethodName.equals("list")) {
					articleController.showList();
				}
			}	
```

- 디스패쳐 서블릿은 HTTP 프로토콜로 들어오는 모든 요청을 가장 먼저 받아 적합한 컨트롤러에 위임해주는 프론트 컨트롤러 역할
- requestUriBits[3]은(article)  컨트롤러이름, requestUriBits[4]는 메소드네임
- ```http://localhost:8080/JSP_AM/s/article/list``` 으로 요청이 들어올시
- 컨트롤러 이름이 article이므로 articleController 생성
- 메소드네임이 list이므로 articleController.showList(); 실행

**2\) articleController**	

```java
    public class ArticleController {
        HttpServletRequest request;
        HttpServletResponse response;
        ArticleService articleService;
        public ArticleController(HttpServletRequest request, HttpServletResponse response, Connection conn) {
            this.request = request;
            this.response = response;
            articleService = new ArticleService(conn);
        }
        public void showList() throws ServletException, IOException {
            int page = 1;
            if (request.getParameter("page") != null && request.getParameter("page").length() != 0) {
                page = Integer.parseInt(request.getParameter("page"));
            }					
            List<Map<String, Object>> articleRows = articleService.getForPrintArticleRows(page);

            int totalPage = articleService.getForPrintListTotalPage();

            request.setAttribute("articleRows", articleRows);
            request.setAttribute("totalPage", totalPage);
            request.setAttribute("page", page);

            request.getRequestDispatcher("/jsp/article/list.jsp").forward(request, response);		
        }
    }
```

- articleController.showList()을 실행하게되면 list.jsp파일로 브라우저에 응답하는 구조
- list.jsp파일에 전달해야할 데이터들을 articleService에 요청 

**3\) articleService**	

```java
    public class ArticleService {
        private ArticleDao articleDao;
        public ArticleService(Connection conn) {
            articleDao = new ArticleDao(conn);
        }
        private int getItemsInAPage() {		
            return 10;
        }

        public List<Map<String, Object>> getForPrintArticleRows(int page) {
            int itemsInAPage = getItemsInAPage();
            int limitFrom = (page - 1) * itemsInAPage;

            List<Map<String, Object>> articleRows = articleDao.getArticleRows(limitFrom, itemsInAPage);

            return articleRows;
        }
```

- articleService에서는 DB에서 가져와야하는 데이터는 articleDao에게 위임 
- articleDao로 부터 전달받은 데이터를 articleController로 전달

**3\) articleDao**	

```java
public class ArticleDao {
	private Connection conn;
	
	public ArticleDao(Connection conn) {
		this.conn = conn;
	}
	
	public List<Map<String, Object>> getArticleRows(int limitFrom, int itemsInAPage) {
		
		SecSql sql = SecSql.from("SELECT A.*, M.name AS writer__name");
		sql.append("FROM article AS A INNER JOIN `member` AS M");
		sql.append("ON A.memberId = M.id");
		sql.append("ORDER BY A.id DESC");
		sql.append("LIMIT ?,?", limitFrom, itemsInAPage);
		List<Map<String,Object>> articleRows = DBUtil.selectRows(conn, sql);
		return articleRows;
	}
```

- 직접 DB에 접근하여 데이터를 가져옴
