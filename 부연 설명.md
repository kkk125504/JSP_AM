### 로그인 , 로그아웃 기능 구현



#### 1. 로그인 구현

**1\) login.jsp**  

- MemberLoginSevlet → login.jsp → MemberdoLoginSevlet

```jsp
		<form action="doLogin" method="post"
		onsubmit="LoginForm__submit(this); return false;">
		<div>
			로그인 아이디 : <input autocomplete="off" placeholder="아이디를 입력해주세요"
				name="loginId" type="text" />
		</div>
		<div>
			로그인 비밀번호 : <input autocomplete="off" placeholder="비밀번호를 입력해주세요"
				name="loginPw" type="password" />
		</div>
```

- 회원가입과 비슷한 방식 (MemberJoinSevlet → join.jsp → MemberdoJoinSevlet)
- login.jsp에서 아이디와 비밀번호를 입력받고 doLogin서블릿으로 요청

**2\) MemberdoJoinSevlet**  

```java
        String loginId = request.getParameter("loginId");
        String loginPw = request.getParameter("loginPw");

        SecSql sql = SecSql.from("SELECT * FROM `member`");
        sql.append("WHERE loginId = ?", loginId);

        Map<String, Object> memberRow = DBUtil.selectRow(conn, sql);

        if (memberRow.isEmpty()) {
            response.getWriter()
                .append("<script>alert('해당하는 아이디를 찾을수 없습니다.'); location.replace('login');</script>");
            return;
        }
        if(memberRow.get("loginPw").equals(loginPw)==false) {
            response.getWriter()
                .append("<script>alert('비밀번호가 일치하지 않습니다.'); location.replace('login');</script>");
            return;
        }
        HttpSession session = request.getSession();	
        
        response.getWriter()
            .append(String.format("<script>alert('%s 님 환영합니다.'); location.replace('../home/main');</script>",memberRow.get("name")));
```

- 전송받은 아이디으로 쿼리문을 통해 조회
-  Map<String, Object> memberRow타입으로 DB에서 조회한 데이터를 저장
- 이때 조회한데이터가 없을시 isEmpty()는 true, 해당아이디가 존재여부 확인가능
- memberRow.get("loginPw").equals(loginPw)==false 입력받은 비밀번호와 DB에저장되있는 비밀번호 비교
-  HttpSession session = request.getSession(); 세션을 가져오는 메소드 
- session.setAttribute("loginedMemberId", memberRow.get("id"));  session.setAttribute("loginedMemberLoginId",memberRow.get("loginId")); 로 세션에 회원번호와 아이디를 저장

#### 2 . 로그아웃 구현

**1\) MemberLogoutServlet**

```jsp
		HttpSession session = request.getSession();
		session.removeAttribute("loginedMemberId");
		session.removeAttribute("loginedMemberLoginId");
		
		response.getWriter()
		.append("<script>alert('로그아웃 되었습니다.'); location.replace('../home/main');</script>");
```

- HttpSession session = request.getSession(); 세션 객체를 가져오고
- session.removeAttribute()를 통해 세션객체안에 저장되있는 로그인된 아이디와 회원번호를 remove

