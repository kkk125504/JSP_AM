### 리스트, 상세보기에 작성자 표시, 수정/삭제 권한체크, 로그인체크

**1\) 리스트, 상세보기시 작성자 표시**

```java
		SecSql sql = SecSql.from("SELECT A.*, M.name AS writer__name");
			sql.append("FROM article AS A INNER JOIN `member` AS M");
			sql.append("ON A.memberId = M.id");
			sql.append("ORDER BY A.id DESC");
			sql.append("LIMIT ?,?", limitFrom, limitTake);

List<Map<String, Object>> articleRows = DBUtil.selectRows(conn, sql);
```

- 기존에는 DB에서 게시물 데이터만 가져왔지만 작성자가 필요한 상황
- 게시물에 저장되있는 memberId와 회원번호를 Join하는 쿼리문
- 결과를 List<Map<String, Object>>타입으로 가져온다
- DB를 통해 가져온 articleRows를 list.jsp를 통하여 브라우저로 화면 구현
- 상세보기도 리스트와 동일한 쿼리문으로 데이터를 가져옴 

**2\) 수정/삭제 권한체크**

```java
        int id = Integer.parseInt(request.getParameter("id"));
        SecSql sql = SecSql.from("SELECT *");
        sql.append("FROM article");
        sql.append("WHERE id = ?", id);

        Map<String, Object> articleRow = DBUtil.selectRow(conn, sql);

        int loginedMemberId = (int)session.getAttribute("loginedMemberId");
        if(loginedMemberId != (int)articleRow.get("memberId")) {
            response.getWriter().append(String.format("<script>alert('%d번 글에 대한 수정 권한이 없습니다.'); location.replace('list');</script>", id));
            return;
        }	
```

- 로그인을 했다면 session에 로그인한 회원의 아이디와 번호가 저장되 있다
- 로그인 후 게시글작성이 가능, 게시글작성시 로그인된 회원의 번호를 기록
- (int)session.getAttribute("loginedMemberId") 세션에 저장되있는 회원 번호와
- (int)articleRow.get("memberId") 해당 게시물에 저장되있는 회원번호(memberId)가 일치하지 않는다면 수정 권한이 없다
- 삭제도 동일 즉, 본인이 쓴글에 수정과 삭제 가능

**3\) 로그인체크**

```java
		HttpSession session = request.getSession();
		if(session.getAttribute("loginedMemberLoginId")== null) {
			response.getWriter()
			.append("<script>alert('로그인 후 이용가능합니다.'); location.replace('join');</script>");
			return;
		}
```

- 로그인을 했다면 request.getSession()에 회원번호와 로그인아이디가 저장되있다
- session.getAttribute("loginedMemberLoginId") 가 null이라면 로그인을 하지 않은것



